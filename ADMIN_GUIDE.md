# 🎫 관리자 가이드: 로그 분석 및 봇 탐지

> 생성일: 2026-01-23  
> 수정일: 2026-01-27  
> 티켓 예매 시스템 - 행동 데이터 분석 가이드

---

## 1. 관리자가 확인할 수 있는 정보

### 1.1 세션 기본 정보

| 항목 | 설명 | 예시 |
|------|------|------|
| `session_id` | 세션 고유 식별자 | `book_f3i9nplz` |
| `user_ip` | 접속 IP 주소 | `127.0.0.1` |
| `user_email` | 로그인된 사용자 이메일 | `test@example.com` |
| `created_at` | 세션 생성 시각 | `2026-01-23T18:20:36` |
| `booking_id` | 예매 번호 (결제 완료 시) | `M31135700` |
| `payment_completed` | 결제 완료 여부 | `true` / `false` |

---

### 1.2 예매 플로우별 수집 데이터

> ⚠️ **현재 로그 수집 범위**: 구역선택 → 좌석선택 → 할인권종 진입까지

| 단계 | 수집 항목 | 로그 수집 |
|------|----------|----------|
| ⏳ **대기열** | 대기 순번, 대기 시간, 마우스 궤적 | ✅ 수집 |
| 📍 **구역선택** | 클릭 구역, 좌표(x,y), 마우스 궤적(30ms) | ✅ 수집 |
| 🎫 **좌석선택** | 선택 좌석, 클릭 좌표, 호버, 마우스 궤적(30ms) | ✅ 수집 |
| 💳 **할인권종** | (페이지 진입 시 로그 전송 및 종료) | ✅ 종료점 |

---

### 1.3 브라우저/OS 핑거프린트 (봇 탐지용)

| 항목 | 필드명 | 설명 | 봇 의심 기준 |
|------|--------|------|--------------|
| **헤드리스 탐지** | `webdriver` | 자동화 도구 사용 여부 | `true` |
| **운영체제** | `platform` | OS 플랫폼 (Win32 등) | UserAgent와 불일치 |
| **하드웨어** | `hardwareConcurrency` | CPU 코어 수 | 비정상적으로 낮거나 높음 |
| **입력 장치** | `maxTouchPoints` | 터치 지원 여부 | 모바일 UA인데 0인 경우 |
| **화면 크기** | `screen`, `window`, `viewport` | 모니터/창/뷰포트 크기 | `viewport`와 `screen`이 지나치게 작거나 큼, 매크로 군집과 동일한 창 크기 |
| **타임존** | `timezone` | 시간대 설정 | IP 위치와 불일치 |

---

### 1.4 행동 분석 데이터 (30ms 정밀 수집)

| 데이터 유형 | 형식 | 특징 |
|------------|------|------|
| **마우스 궤적** | `{x, y, nx, ny, t}` | **30ms 간격** 수집 (초당 약 33개). 클릭 시 좌표 자동 추가로 끊김 없음. |
| **클릭** | `{x, y, nx, ny, ...}` | 실제 마우스 좌표(`e.clientX/Y`) 사용. 궤적과 정확히 일치. |
| **호버** | `{target, duration}` | 머문 시간, 탐색 패턴 |

---

## 2. 사람 vs 봇 행동 패턴 비교

### 2.1 마우스 궤적 (Mouse Trajectory)

> **참고**: 빠른 예매 시 사람도 미세 떨림이 적을 수 있습니다.

| 특성 | 👤 사람 | 🤖 봇 |
|------|--------|------|
| **경로 형태** | 곡선, 불규칙적 | 완전 직선, 수학적 경로 |
| **속도 변화** | 가속/감속 (목표 근처 감속) | 등속 또는 순간 이동 |
| **미세 떨림** | 천천히 움직일 때 관찰됨 | 없음 (매우 매끄러움) |
| **방향 전환** | 부드러운 곡선 | 각진 전환 (또는 없음) |

### 2.2 클릭 패턴 (Click Pattern)

| 특성 | 👤 사람 | 🤖 봇 |
|------|--------|------|
| **클릭 타이밍** | 불규칙 | 일정함 (예: 정확히 100ms 후) |
| **클릭 전 멈춤** | 확인을 위한 짧은 멈춤 (Target Acquisition) | 멈춤 없이 즉시 클릭 |
| **좌표 정확도** | 버튼 중심에서 벗어남 | 버튼 정중앙 또는 동일 픽셀 반복 |

### 2.3 체류 시간 (Duration)

| 특성 | 👤 사람 | 🤖 봇 |
|------|--------|------|
| **반응 속도** | 페이지 로드 후 인지 시간 필요 | 로드 즉시 반응 (0.1초 미만) |
| **단계별 시간** | 가변적 | 항상 최소 시간 유지 |

---

## 3. 봇 유형별 특징

| 봇 유형 | 설명 | 핵심 특징 |
|--------|------|----------|
| **fast_click** | 빠른 클릭 봇 | 클릭 간격 0.05~0.2초, 호버 없음 |
| **linear_move** | 직선 이동 봇 | 마우스가 직선으로만 이동 |
| **repeat_pattern** | 반복 패턴 봇 | 정확히 1초 간격 클릭 |
| **slow_auto** | 느린 자동화 봇 | 사람처럼 보이려 하나 규칙적 |
| **fixed_coord** | 좌표 고정 봇 | 마우스 궤적 없음, 클릭만 |
| **queue_bypass** | 대기열 우회 봇 | 대기열 통과 시간 0.5~2초 |

---

## 4. 봇 탐지 지표 (Bot Score)

| 점수 | 판정 | 시각화 색상 |
|------|------|------------|
| 0~40% | 🟢 정상 | 초록색 |
| 40~70% | 🟡 의심 | 노란색 |
| 70~100% | 🔴 봇 | 빨간색 |

### 주요 탐지 기준
1. ⏱️ 비정상적으로 빠른 완료 시간
2. 📐 직선적인 마우스 이동
3. ⏲️ 일정한 클릭 간격
4. 🖱️ 호버 없이 즉시 클릭
5. 🎯 너무 정확한 좌표

---

## 5. 로그 뷰어 사용법

### 5.1 접속
```
http://localhost:8000/viewer
```

### 5.2 화면 구성
- **왼쪽**: 세션 로그 목록 (정상: 파란 배지, 봇: 빨간 배지)
- **오른쪽**: 상세 정보 (세션 정보, 궤적, 통계, 원본 JSON)

### 5.3 궤적 캔버스
| 표시 | 의미 |
|------|------|
| 🟢 녹색 원 | 시작점 |
| 🟠 주황 원 | 끝점 |
| 🔴 빨간 원 | 클릭 포인트 |
| 🔵 파란 선 | 마우스 이동 궤적 |

### 5.4 hover 정보
포인트에 마우스를 올리면 표시:
- **단계**: 어느 예매 단계인지 (좌석선택, 결제 등)
- **좌표**: (x, y) 픽셀 좌표
- **대상**: 클릭한 요소 (좌석 ID, 버튼 등)

---

## 6. 로그 파일 구조

### 6.1 저장 위치
```
logs/
├── perf_*.json   # 🎭 공연창 로그
├── que_*.json    # ⏳ 대기열 로그
└── book_*.json   # 🎫 예매창 로그 (상세)
```

### 6.2 파일명 규칙
```
{stage}_{session_id}_{날짜}_{시간}_{stage}.json
```

예: `book_f3i9nplz_20260123_182036_book.json`

---

## 7. 분석 체크리스트

### 봇 의심 시 확인사항

- [ ] 마우스 궤적이 직선인가?
- [ ] 클릭 간격이 일정한가?
- [ ] 전체 완료 시간이 비정상적으로 짧은가?
- [ ] 호버 행동이 없거나 극히 적은가?
- [ ] 캡챠 입력 시간이 0.5초 미만인가?
- [ ] 동일 IP에서 반복 세션이 있는가?

---

*이 가이드는 티켓 예매 시스템의 봇/매크로 탐지를 위한 관리자용 문서입니다.*
