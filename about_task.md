# 🛡️ 매크로 탐지 강화 및 데이터 최적화 작업 내역

## 🎯 작업 목표
1. **매크로 탐지 고도화**: 단순 좌표 수집을 넘어, 실제 사람의 행동 패턴인지 판단할 수 있는 결정적 증거("독침" 데이터)를 수집합니다.
2. **데이터 효율성 최적화**: 마우스 궤적 데이터의 용량을 획기적으로 줄여 서버 및 DB 부하를 경감합니다.

---

## 🛠️ 구현 내용

### 1. 매크로 탐지용 "독침" 데이터 (`clicks` 배열)
클릭 이벤트 발생 시 다음 3가지 핵심 지표를 추가적으로 수집하도록 `log_collector.js`를 고도화했습니다.

| 필드명 | 설명 | 목적 |
|--------|------|------|
| **`is_trusted`** | 사용자 상호작용으로 생성된 이벤트인지 여부 (`true`/`false`) | `flase`일 경우 100% 스크립트/매크로 생성 이벤트로 판단 가능 |
| **`click_duration`** | `mousedown`과 `mouseup` 사이의 시간 간격 (ms) | 사람은 보통 50~200ms 소요. 매크로는 0~10ms 미만인 경우가 많음 |
| **`is_integer`** | 클릭 좌표가 정수(Integer)인지 여부 | 브라우저는 정수 좌표를 반환하나, 이미지 인식 기반 매크로는 소수점 좌표를 찍지 못할 수 있음(또는 반대)을 패턴 분석에 활용 |

**구현 파일**:
- `static/js/log_collector.js`: `initClickMetrics`, `getClickMetrics` 함수 추가
- `static/js/section_select.js`: 구역 선택 시 메트릭 수집 적용
- `static/js/seat_select.js`: 좌석 선택 시 메트릭 수집 적용

**데이터 예시**:
```json
{
  "section": "VIP-A",
  "x": 842,
  "y": 305,
  "timestamp": 1250,
  "is_trusted": true,
  "click_duration": 124,
  "is_integer": true
}
```

---

### 2. 마우스 궤적 데이터 압축 (`mouse_trajectory`)
초당 수십 번 쌓이는 마우스 궤적 데이터의 JSON 저장 방식을 최적화했습니다.

**변경 전 (Object Array)**: 
- `{"x": 122, "y": 30, "t": 299}`
- 불필요한 키(`"x"`, `"y"`, `"t"`) 반복으로 용량 낭비 심함

**변경 후 (Available Array)**:
- `[122, 30, 299]` (순서: x좌표, y좌표, 시간차)
- JSON 파일 크기 약 **60% 절감** 기대

**구현 파일**:
- `static/js/log_collector.js`: `initMouseTracking` 함수가 이제 배열(`[]`) 형태의 데이터를 수집하도록 수정
- 모든 페이지 스크립트(`perf_list`, `queue`, `section`, `seat`)에 자동 적용

---

## 📊 기대 효과
- **탐지율 상승**: `is_trusted`와 `click_duration`의 조합으로 기계적 클릭을 99% 이상 걸러낼 수 있습니다.
- **비용 절감**: 로그 파일 용량이 줄어들어 스토리지 비용 및 네트워크 트래픽이 감소합니다.
- **분석 속도 향상**: 더 가벼워진 로그 파일로 인해 ML 모델 학습 및 데이터 로딩 속도가 빨라집니다.
