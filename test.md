# 🎫 티켓 예매 시스템 (현재 구현 완료)

FastAPI 기반 티켓 예매 시스템 - 봇 탐지용 행동 데이터 수집

---

## 📁 프로젝트 구조

```
c:\Users\Admin\PycharmProjects\dev\
├── main.py                    # FastAPI 메인 서버
├── requirements.txt           # 의존성
├── users.json                 # 사용자 데이터
├── ai_03_action_logs.csv      # CSV 액션 로그
├── logs/                      # JSON 세션 로그 (3단계 로그)
└── templates/
    ├── login.html             # 로그인/회원가입
    ├── performances.html      # 공연 목록 (8개 공연)
    ├── queue.html             # 대기열
    ├── captcha.html           # 보안문자
    ├── section_select.html    # 🆕 구역 선택 (8개 구역)
    ├── index.html             # 좌석 선택 (구역별 필터링)
    ├── step2_discount.html    # 할인권종 선택
    ├── step3_booker.html      # 예매자/배송 정보
    ├── step4_payment.html     # 결제 수단 선택
    └── viewer.html            # 로그 시각화
```

---

## 🔄 예매 흐름 (8단계)

```
로그인 → 공연목록 → 날짜선택 → 대기열 → 캡챠 → 구역선택 → 좌석선택 → 할인/배송/결제 → 완료
```

---

## 🎭 구역 구조 (8개 구역)

```
             🎤 STAGE
  
  [VIP-L]    [VIP-C]    [VIP-R]    ← A~D행, 금색
  
  [R-L]      [R-C]      [R-R]      ← E~L행, 파랑
  
     [S-L]           [S-R]         ← M~P행, 녹색
```

| 구역 | 행 | 열 범위 | 좌석 수 |
|------|-----|---------|---------|
| VIP-L/C/R | A~D | 1-20/21-40/41-60 | 각 80석 |
| R-L/C/R | E~L | 1-20/21-40/41-60 | 각 160석 |
| S-L/R | M~P | 1-30/31-60 | 각 120석 |

---

## 📊 3단계 로그 시스템

| 단계 | 파일명 | 범위 | 수집 데이터 |
|------|--------|------|-------------|
| **perf** | `{id}_{time}_perf.json` | 공연목록→예매시작 | 카드클릭, 날짜/시간선택, 마우스궤적 |
| **que** | `{id}_{time}_que.json` | 대기열 진입→입장 | 위치변화, 대기시간, 완료시점 |
| **book** | `{id}_{time}_book.json` | 캡챠→결제완료 | 캡챠시도, 구역/좌석선택, 할인/배송/결제 |

---

## ⚙️ 핵심 기능

| 기능 | 설명 |
|------|------|
| **공연별 차등 대기열** | BTS 15,000명, 뮤지컬 2,000명, 발레 500명 |
| **앞좌석 우선 매진** | A~D행, 중앙 좌석 높은 매진 확률 |
| **이선좌 기능** | 30% 확률로 "이미 선점됨" 팝업 |
| **사이드바 좌석 취소** | X버튼으로 개별 좌석 취소 |
| **캡챠** | 영어 대문자만, 3분 제한 |
| **봇 로그 자동 생성** | 6회 예매마다 2+1 봇 로그 생성 |

---

## 🔧 API 엔드포인트

| 메소드 | 경로 | 설명 |
|--------|------|------|
| POST | `/login`, `/register` | 인증 |
| GET | `/performances` | 공연 목록 |
| GET | `/queue/{perf_id}` | 대기열 |
| GET | `/captcha/{perf_id}` | 캡챠 |
| GET | `/section/{perf_id}` | 구역 선택 |
| GET | `/booking/{perf_id}` | 좌석 선택 |
| GET | `/step2-4/{perf_id}` | 할인/배송/결제 |
| POST | `/api/stage-log` | 3단계 로그 저장 |
| POST | `/api/complete` | 예매 완료 |
| GET | `/viewer` | 로그 뷰어 |

---

## ✅ 구현 완료 항목

- [x] 사용자 인증 (로그인/회원가입)
- [x] 8개 공연 데이터 (BTS, BLACKPINK, 뮤지컬 등)
- [x] 공연별 차등 대기열
- [x] 영문 캡챠 (대문자만)
- [x] 8개 구역 선택 (VIP/R/S)
- [x] 구역별 좌석 필터링
- [x] 앞좌석 우선 매진 로직
- [x] 이선좌(30%) 기능
- [x] 사이드바 좌석 개별 취소
- [x] 3단계 로그 시스템 (perf/que/book)
- [x] 로그에 사용자 이메일 포함
- [x] 로그 뷰어 (체류시간/클릭/호버 표시)
