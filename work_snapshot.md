# 작업 상태 스냅샷
> 생성일시: 2026-01-23 22:25  
> 수정일시: 2026-01-27 01:05

---

## 1. 사용자 피드백 및 판단 기준

### 로그 궤적 뷰어에서 클릭이 표시되어야 함
- **피드백**: "로그 궤적에 왜 클릭하는 건 안 나와?"
- **중요 이유**: 봇 탐지 분석 시 클릭 패턴(위치, 빈도, 타이밍)은 핵심 지표. 궤적만으로는 분석 불완전.
- **조치**: 모든 예매 단계에서 클릭 좌표(x, y) 수집 및 저장 ✅ 완료

### 궤적 캔버스가 더 크고 자세해야 함
- **피드백**: "비율이 살짝 다른 것 같아", "조금 더 크고 자세하게 볼 수 있게 해줘"
- **중요 이유**: 실제 화면과 비율이 다르면 분석 정확도 저하. 작은 캔버스로는 세밀한 움직임 파악 어려움.
- **조치**: 캔버스 500px, 16:9 비율 유지, 확대/축소 기능 ✅ 완료

### 포인트 hover 시 단계 정보 필수
- **피드백**: "클릭 좌표에 마우스 올리면 예매 단계 중 어디인지, 좌표까지 노출 시켜줄 수 있나?"
- **중요 이유**: 궤적만 보면 어떤 단계인지 알 수 없음. 단계별 행동 패턴 분석에 필수.
- **조치**: 시작점/끝점/클릭 모두 hover 시 `단계 | 좌표 | 대상` 표시 ✅ 완료

### 순서가 논리적으로 맞아야 함
- **피드백**: "왜 시작점이 좌석선택이고 끝점이 구역선택인지 이유를 말해볼래?"
- **중요 이유**: 시작/끝점이 실제 흐름과 안 맞으면 분석 혼란. 데이터 신뢰도 문제.
- **조치**: 실제 예매 흐름 순서로 통합 ✅ 완료

### 로그 수집 범위 축소 (2026-01-27)
- **피드백**: "captcha, booker, payment는 제외하고 구역선택~좌석선택~할인권종 진입까지만 수집해줘"
- **중요 이유**: AI 학습에 필요한 핵심 행동만 수집하여 데이터 간소화
- **조치**: 
  - captcha.html에서 로그 초기화 코드 제거 ✅
  - section_select.html을 로그 시작점으로 변경 ✅
  - step2_discount.html 진입 시 로그 전송 및 종료 ✅
  - step3_booker.html, step4_payment.html에서 book 로그 코드 제거 ✅

### 로그 뷰어 및 수집 정밀도 개선 (2026-01-27)
- **피드백**: "호버랑 클릭 좌표가 일치하지 않아", "미세 떨림이 잘 안 보여"
- **조치**:
  - **수집 간격 단축**: 100ms → 30ms (초당 33개) ✅
  - **클릭 동기화**: 클릭 시 좌표를 궤적에 자동 추가하여 끊김 현상 해결 ✅
  - **실제 좌표 사용**: 요소 중심점이 아닌 `e.clientX/Y` 사용 ✅
  - **줌 확대**: 뷰어 최대 확대 배율 300% → 1000% ✅
  - **시간 표시**: 상대 시간(+0.5s) → 절대 시간(ISO)으로 변경 ✅

### 브라우저 핑거프린팅 추가 (2026-01-27)
- **목적**: Headless Chrome 및 봇/매크로 탐지
- **수집 항목**: `webdriver`(봇), `platform`, `hardwareConcurrency`, `maxTouchPoints`, `screen`, `window` 크기 등 ✅
- **제외 항목**: `language`(사용자 불확실성으로 제외) ✅

---

## 2. 수정/번복된 생각 흐름

| 시점 | 판단 | 수정 이유 |
|------|------|----------|
| 초기 | 마우스 수집 100ms | 일반적인 분석에 충분할 것이라 판단 |
| 수정 후 | 마우스 수집 30ms | 미세 떨림 포착 및 정밀 궤적 필요 |
| 초기 | 언어 설정(`language`) 수집 | 봇 탐지 지표로 활용 예정 |
| 수정 후 | 언어 설정 수집 제외 | 정상 사용자(외국인, 개발자 등) 오탐 가능성 |
| 초기 | 미세 떨림이 봇 탐지 핵심 | 사람이 마우스를 쥐고 있으므로 떨림 발생 |
| 결론 | **속도 변화, 멈춤, 곡률이 핵심** | 빠른 티켓팅 시 사람도 떨림 적음. 떨림보단 '부자연스러움' 탐지가 유효 |

---

## 3. 현재 유지해야 할 방향성과 제약 조건

### 방향성
- **분석 정확도 우선**: 시각화는 "예뻐 보이는 것"보다 "정확한 분석"이 목적
- **흐름 일관성**: 데이터 순서는 실제 사용자 행동 순서와 일치해야 함
- **좌표 표준화**: 모든 좌표는 정규화(0~1)로 저장하여 비교 가능하게
- **정밀 수집**: 30ms 간격 유지, 클릭-궤적 동기화 필수

### 제약 조건
- 서버: FastAPI + Uvicorn (`--reload` 모드)
- 클릭 데이터 형식: `{x, y, nx, ny, viewport, target, timestamp}`
- 마우스 궤적 형식: `{x, y, nx, ny, t}` (t는 페이지 진입 후 ms)

---

## 4. 완료된 작업 (2026-01-27 기준)

| 작업 | 파일 | 상태 |
|------|------|------|
| 로그 수집 범위 축소 | `captcha.html` ~ `step4_payment.html` | ✅ 완료 |
| 좌표 정규화 (A+B) | `section_select.html`, `index.html` | ✅ 완료 |
| 로그 뷰어 기능 강화 | `viewer.html` | ✅ 완료 (줌, 시간, ID표시) |
| 브라우저 정보 수집 | `section_select.html` | ✅ 완료 |
| 마우스 30ms/동기화 | `section_select.html`, `queue.html` | ✅ 완료 |
| 관리자 가이드 업데이트 | `ADMIN_GUIDE.md` | ✅ 완료 |

---

## 작업 전제로 사용할 핵심 원칙

1. **순서는 실제 흐름과 일치** - 데이터 통합 시 반드시 예매 흐름 순서 준수
2. **hover는 정보성** - 포인트 hover 시 단계, 좌표, 대상 모두 표시
3. **좌표는 정규화** - 모든 좌표에 nx, ny (0~1) 포함하여 화면 크기 무관 비교 가능
4. **작업 변경 시 부작용 확인** - 순서/구조 변경 후 시작점/끝점 논리 확인 필수
5. **문서화 유지** - 변경사항은 가이드 문서에 반영
