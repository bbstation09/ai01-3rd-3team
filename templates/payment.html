<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²°ì œ | í‹°ì¼“ ì˜ˆë§¤</title>
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/payment.css">
</head>

<body>
    <header class="header">
        <a href="/performances" class="logo">TICKET<span>PARK</span></a>
        <div class="timer" id="timer">05:00</div>
    </header>

    <div class="step-indicator">
        <div class="steps">
            <div class="step completed">
                <div class="step-num">âœ“</div><span>ì¢Œì„ì„ íƒ</span>
            </div>
            <div class="step-line completed"></div>
            <div class="step completed">
                <div class="step-num">âœ“</div><span>í• ì¸ê¶Œì¢…</span>
            </div>
            <div class="step-line completed"></div>
            <div class="step completed">
                <div class="step-num">âœ“</div><span>ì˜ˆë§¤ì •ë³´</span>
            </div>
            <div class="step-line completed"></div>
            <div class="step active">
                <div class="step-num">4</div><span>ê²°ì œ</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="section">
            <div class="section-header">ğŸ’³ ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ</div>
            <div class="section-body">
                <div class="payment-grid">
                    <label class="payment-option selected" onclick="selectPayment(this, 'card')">
                        <input type="radio" name="payment" value="card" checked>
                        <div class="payment-icon">ğŸ’³</div>
                        <span>ì‹ ìš©ì¹´ë“œ</span>
                    </label>
                    <label class="payment-option" onclick="selectPayment(this, 'bank')">
                        <input type="radio" name="payment" value="bank">
                        <div class="payment-icon">ğŸ¦</div>
                        <span>ê³„ì¢Œì´ì²´</span>
                    </label>
                    <label class="payment-option" onclick="selectPayment(this, 'phone')">
                        <input type="radio" name="payment" value="phone">
                        <div class="payment-icon">ğŸ“±</div>
                        <span>íœ´ëŒ€í°ê²°ì œ</span>
                    </label>
                    <label class="payment-option" onclick="selectPayment(this, 'kakao')">
                        <input type="radio" name="payment" value="kakao">
                        <div class="payment-icon">ğŸ’›</div>
                        <span>ì¹´ì¹´ì˜¤í˜ì´</span>
                    </label>
                    <label class="payment-option" onclick="selectPayment(this, 'naver')">
                        <input type="radio" name="payment" value="naver">
                        <div class="payment-icon">ğŸ’š</div>
                        <span>ë„¤ì´ë²„í˜ì´</span>
                    </label>
                    <label class="payment-option" onclick="selectPayment(this, 'toss')">
                        <input type="radio" name="payment" value="toss">
                        <div class="payment-icon">ğŸ”µ</div>
                        <span>í† ìŠ¤í˜ì´</span>
                    </label>
                </div>
            </div>
        </div>

        <div class="summary-box">
            <div class="summary-title">ğŸ“‹ ê²°ì œ ì •ë³´</div>
            <div class="summary-row"><span>{{ performance.title }}</span></div>
            <div class="summary-row"><span>{{ selected_date }} {{ selected_time }}</span></div>
            <div class="summary-row"><span>ì¢Œì„: {{ selected_seats | join(', ') }}</span></div>
            <div class="summary-row"><span>í‹°ì¼“ ê¸ˆì•¡</span><span>{{ "{:,}".format(total_price) }}ì›</span></div>
            <div class="summary-row"><span>í• ì¸ ê¸ˆì•¡</span><span>-{{ "{:,}".format(discount_amount) }}ì›</span></div>
            <div class="summary-row"><span>ë°°ì†¡ë¹„</span><span>{{ "{:,}".format(delivery_fee) }}ì›</span></div>
            <div class="summary-total"><span>ì´ ê²°ì œê¸ˆì•¡</span><span>{{ "{:,}".format(final_price) }}ì›</span></div>
        </div>

        <div class="action-bar">
            <button class="btn btn-back" onclick="history.back()">ì´ì „</button>
            <button class="btn btn-pay" onclick="completeBooking()">{{ "{:,}".format(final_price) }}ì› ê²°ì œí•˜ê¸°</button>
        </div>
    </div>

    <!-- ìº¡ì±  ëª¨ë‹¬ -->
    <div class="modal-overlay" id="captchaModal">
        <div class="modal">
            <h3 class="captcha-title">ğŸ”’ ë³´ì•ˆë¬¸ì ì…ë ¥</h3>
            <div class="captcha-image" id="captchaText"></div>
            <input type="text" class="captcha-input" id="captchaInput" placeholder="ìœ„ ë¬¸ì ì…ë ¥" maxlength="6">
            <button class="btn-captcha" onclick="verifyCaptcha()">í™•ì¸</button>
            <p class="captcha-error" id="captchaError">ë³´ì•ˆë¬¸ìê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ì™„ë£Œ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="completeModal">
        <div class="modal">
            <div class="complete-icon">ğŸ‰</div>
            <h3 class="complete-title">ì˜ˆë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
            <p class="complete-info">ì˜ˆë§¤ ë‚´ì—­ì€ ë§ˆì´í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <div class="booking-id" id="bookingId"></div>
            <button class="btn-captcha" onclick="location.href='/performances'">í™•ì¸</button>
        </div>
    </div>

    <script>
        // í…œí”Œë¦¿ ë³€ìˆ˜
        const sessionId = "{{ session_id }}";
        const perfId = "{{ performance.id }}";
        const selectedSeats = {{ selected_seats | tojson | safe }};
        const discountType = "{{ discount_type }}";
        const deliveryType = "{{ delivery_type }}";
    </script>
    <script src="/static/js/log_collector.js"></script>
    <script src="/static/js/payment.js"></script>
</body>

</html>